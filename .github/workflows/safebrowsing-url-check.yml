name: Automated Safe Browsing Runs 

on:
  # run daily
  schedule:
    - cron: "0 12 * * *"
  # allow manual runs from GH
  workflow_dispatch:

env:
  NODE_VERSION: "18.x"

jobs:
  check-all-urls-in-db:
    runs-on: ubuntu-latest
    steps:
      - name: 👷  Checkout Repo
        uses: actions/checkout@v3

      - name: 🏗️  Setup Node.js ${{ env.NODE_VERSION }} environment
        uses: actions/setup-node@v3
        with:
          node-version: ${{ env.NODE_VERSION }}
          check-latest: true

      - name: ⬆️  Update npm and install dependencies
        run: npm i -g npm --silent && npm ci --omit=dev --silent

      - name: 🏃‍♂️  Run script to check all URLs in db against Google Safe Browsing API
        run: npm run check-all-urls